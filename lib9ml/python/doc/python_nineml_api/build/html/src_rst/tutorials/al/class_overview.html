

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Basic Structure of NineML Abstraction Layer &mdash; NineML Python API Alpha documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'Alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="NineML Python API Alpha documentation" href="../../../index.html" />
    <link rel="up" title="&lt;no title&gt;" href="al.html" />
    <link rel="next" title="Importing and Exporting" href="importing_exporting.html" />
    <link rel="prev" title="&lt;no title&gt;" href="al.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="importing_exporting.html" title="Importing and Exporting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="al.html" title="&lt;no title&gt;"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">NineML Python API Alpha documentation</a> &raquo;</li>
          <li><a href="../../../python_nineml.html" >Python NineML User Documentation</a> &raquo;</li>
          <li><a href="al.html" accesskey="U">&lt;no title&gt;</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="basic-structure-of-nineml-abstraction-layer">
<h1>Basic Structure of NineML Abstraction Layer<a class="headerlink" href="#basic-structure-of-nineml-abstraction-layer" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we build the Izhikevich model neuron. It is defined by the
following dynamics:</p>
<div class="math">
<p><img src="../../../_images/math/6f9b4d2e0fd4531e7d9769c2ac6568919e7782d2.png" alt="\frac{dV}{dt} = 0.04V^2 + 5V + 140 -u + I

\frac{du}{dt} = a(bV -u)"/></p>
</div><p>where if <img class="math" src="../../../_images/math/7226b44c208485dadc4de0ef2788b88e001686f4.png" alt="v&gt; 30mV"/> then we have a spike</p>
<div class="math">
<p><img src="../../../_images/math/dcd2b2ecccd9b07d3fbfc97b694187214f3c4946.png" alt="v \leftarrow c

u \leftarrow u + d"/></p>
</div><p>where <img class="math" src="../../../_images/math/bb60e0857a2c0a2c47acfbe81781032feb1f7150.png" alt="a,b,c,d"/> are parameters of our neuron and <img class="math" src="../../../_images/math/027f4a11d6090f9eac0ce2488df6384dad1263ea.png" alt="I"/> is the injected current. <em>V</em> and <em>U</em> are state variables, which need to be solved over time.</p>
<div class="section" id="interfaces-parameters-and-ports">
<h2>Interfaces: Parameters and Ports<a class="headerlink" href="#interfaces-parameters-and-ports" title="Permalink to this headline">¶</a></h2>
<p>We begin by defining the <em>interface</em> to our neuron. The interface is composed of</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><strong>Parameters</strong>: values used to instantiate a component of a particular type. In this case, these would be</dt>
<dd><p class="first last"><em>a</em>, <em>b</em>, <em>c</em> and <em>d</em>. Parameters are set once at the beginning of a simulation.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Ports</strong>: which allow the component to communicate with other components</dt>
<dd><blockquote class="first">
<div><p>during the simulation. Ports are divided into two categories:</p>
</div></blockquote>
<ul>
<li><dl class="first docutils">
<dt><strong>Event</strong> ports, which transmit or receive single, discrete <em>events</em> at</dt>
<dd><p class="first last">points in time. For example, an event could represent a neuron spiking.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Analog</strong> ports, which transmit or receive continuous signals, for</dt>
<dd><p class="first last">example the membrane voltage of the neuron.</p>
</dd>
</dl>
</li>
</ul>
<p class="last">Furthermore, ports have a <tt class="docutils literal"><span class="pre">direction</span></tt>, specifying whether they represent
information coming from the component <tt class="docutils literal"><span class="pre">send</span></tt>, or information flowing into
the component, <tt class="docutils literal"><span class="pre">recv</span></tt> (And <tt class="docutils literal"><span class="pre">reduce</span></tt>, which will be discussed later.)</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>In this case, the neuron receives an injected current <em>I</em>, which will be a
<tt class="docutils literal"><span class="pre">recv</span></tt> Analog-port. Other components (such as synapses) may be interested in
the neuron&#8217;s voltage, <em>V</em>, so we should transmit this as a <tt class="docutils literal"><span class="pre">send</span></tt> Analog-port.
When the neuron reaches the condition for firing (<img class="math" src="../../../_images/math/7226b44c208485dadc4de0ef2788b88e001686f4.png" alt="v&gt; 30mV"/>), we may also
want to notify other components about this event, so we also have a <tt class="docutils literal"><span class="pre">send</span></tt>
Event-port.</p>
<p>We can build a <a class="reference internal" href="../../reference/nineml.abstraction_layer.component.ComponentClass.html#nineml.abstraction_layer.component.ComponentClass" title="nineml.abstraction_layer.component.ComponentClass"><tt class="xref py py-class docutils literal"><span class="pre">ComponentClass</span></tt></a>  with this interface with the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nineml.abstraction_layer</span> <span class="kn">as</span> <span class="nn">al</span>

<span class="n">iz</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span> 
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;IzikevichNeuron&quot;</span><span class="p">,</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">],</span>
        <span class="n">analog_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">AnalogPort</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;recv&#39;</span><span class="p">),</span>
                         <span class="n">al</span><span class="o">.</span><span class="n">AnalogPort</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="p">],</span>
        <span class="n">event_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">EventPort</span><span class="p">(</span><span class="s">&#39;spikeoutput&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="p">],</span>
        <span class="p">)</span>
            
</pre></div>
</div>
<p>If you try running this code, you will receive the following error:</p>
<div class="highlight-python"><pre>nineml.exceptions.exceptions.NineMLRuntimeError: Unable to find an Alias or State variable for analog-port: V</pre>
</div>
<p>This is because we have defined a component and promised that we will transmit
a value over the port <em>V</em>, but we have not defined <em>V</em> anywhere. We will fix
this next.</p>
</div>
<div class="section" id="dynamics-regimes-statevariables">
<h2>Dynamics: Regimes &amp; StateVariables<a class="headerlink" href="#dynamics-regimes-statevariables" title="Permalink to this headline">¶</a></h2>
<p>Now that we have defined the <em>interface</em> of the <a class="reference internal" href="../../reference/nineml.abstraction_layer.component.ComponentClass.html#nineml.abstraction_layer.component.ComponentClass" title="nineml.abstraction_layer.component.ComponentClass"><tt class="xref py py-class docutils literal"><span class="pre">ComponentClass</span></tt></a>, we now need
to define the internal <em>dynamics</em> of the system, to give it some behaviour. A
ComponentClass can contain <tt class="docutils literal"><span class="pre">StateVariables</span></tt>, which are variables that
describe the internal state of the neuron. Typically, these are specified by
first-order-differential equations with-respect-to time. In our example, the
Izhikevich model has 2 state-variables, <em>U</em> and <em>V</em>.</p>
<p>The state-variables can have different behaviours when operating in
different <em>Regimes</em>. A regime can be considered the &#8216;mode&#8217; of the component; at
any time, the component will be in a single &#8216;regime&#8217;, and it is possible to
move between regimes.  for example, an integrate-and-fire neuron with an
explicit refractory period could be modelled as a component with two regimes, a
default regime, where injected current affects membrane voltage, where and a
second <em>refractory</em> regime where the voltage is fixed to a certain value. This
will be further discussed in XX.</p>
<p>For this model, the differential-equations governing the state variables never
change, so we only need a single regime.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nineml.abstraction_layer</span> <span class="kn">as</span> <span class="nn">al</span>

<span class="c"># Define a single regime, and specify the differential equations:</span>
<span class="n">regime</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span> 
             <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;defaultregime&#39;</span><span class="p">,</span>
             <span class="n">time_derivatives</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="s">&#39;dV/dt = 0.04*V*V + 5*V + 140 -U + I&#39;</span><span class="p">,</span> 
                        <span class="s">&#39;dU/dt = a*(b*V - U)&#39;</span>
                                <span class="p">]</span> <span class="p">)</span>
    


<span class="c"># Create the ComponentClass, including the dynamics.</span>
<span class="n">iz</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span> 
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;IzikevichNeuron&quot;</span><span class="p">,</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">],</span>
        <span class="n">analog_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">AnalogPort</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;recv&#39;</span><span class="p">),</span>
                         <span class="n">al</span><span class="o">.</span><span class="n">AnalogPort</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="p">],</span>
        <span class="n">event_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">EventPort</span><span class="p">(</span><span class="s">&#39;spikeoutput&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="p">],</span>
        
        <span class="n">dynamics</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">(</span> <span class="n">regimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">regime</span><span class="p">],</span> 
                                <span class="n">state_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="s">&#39;U&#39;</span><span class="p">])</span>
        <span class="p">)</span>
            
</pre></div>
</div>
<p>In this case, we have specified the state-variables for this component by
explicitly providing a list of the state-variables to the <tt class="docutils literal"><span class="pre">Dynamics</span></tt> blocks.
This is not essential, if it is not provided, it will automatically be inferred
from the state-variable definitions in the Regimes, but if it is given, it must
match exactly.</p>
<p>This code should now run; but we are missing the condition, <img class="math" src="../../../_images/math/7226b44c208485dadc4de0ef2788b88e001686f4.png" alt="v&gt; 30mV"/>.</p>
</div>
<div class="section" id="transitions-events-conditions-assignments">
<h2>Transitions: Events, Conditions &amp; Assignments<a class="headerlink" href="#transitions-events-conditions-assignments" title="Permalink to this headline">¶</a></h2>
<p>We have discussed that component can contain multiple <tt class="docutils literal"><span class="pre">Regimes</span></tt>. In order to
move between regimes; we introduce the idea of <tt class="docutils literal"><span class="pre">Transition</span></tt> s. A transition
can be:</p>
<blockquote>
<div><ul class="simple">
<li><strong>OnEvent</strong> - A transition triggered by an event arriving on a <tt class="docutils literal"><span class="pre">recv</span></tt>
EventPort.</li>
<li><strong>OnCondition</strong> - A transition triggered by a condition.</li>
</ul>
</div></blockquote>
<p>When a <tt class="docutils literal"><span class="pre">transition</span></tt> occurs, three things can optionally occur:</p>
<blockquote>
<div><ul class="simple">
<li>An event can be emitted on a <tt class="docutils literal"><span class="pre">send</span></tt> EventPort, for example, when a
membrane voltage reaches a threshold values, we may want to send an event
to signal a spike occurring.</li>
<li>StateVariables can be changes through <tt class="docutils literal"><span class="pre">StateAssignment</span></tt>. For example, a
transition in a synapse component may cause the post-synaptic conductance
to increase by a fixed amount.</li>
<li>The component can switch to another regime; i.e. respond to another set of
differential equations.</li>
</ul>
</div></blockquote>
<p>For the Izhikevich model, we will use an &#8216;OnCondition&#8217; transition, which should
update the state-variables, <em>U</em> and <em>V</em> according to the equations:</p>
<div class="math">
<p><img src="../../../_images/math/dcd2b2ecccd9b07d3fbfc97b694187214f3c4946.png" alt="v \leftarrow c

u \leftarrow u + d"/></p>
</div><p>We will also emit a spike on the EventPort <tt class="docutils literal"><span class="pre">spikeoutput</span></tt>, as this might be
useful if we want to use this component as part of a larger system. Since we
only have a single regime, we will not change regime.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nineml.abstraction_layer</span> <span class="kn">as</span> <span class="nn">al</span>

<span class="c"># Define a single regime, and specify the differential equations,</span>
<span class="c"># and a transition when we reach spiking threshold:</span>
<span class="n">regime</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span> 
             <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;defaultregime&#39;</span><span class="p">,</span>
             <span class="n">time_derivatives</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="s">&#39;dV/dt = 0.04*V*V + 5*V + 140 -U + I&#39;</span><span class="p">,</span> 
                        <span class="s">&#39;dU/dt = a*(b*V - U)&#39;</span>
                                <span class="p">],</span>
             <span class="n">transitions</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">On</span><span class="p">(</span> <span class="s">&#39;V &gt; a&#39;</span> <span class="p">,</span>
                                    <span class="n">do</span> <span class="o">=</span> <span class="p">[</span>  <span class="s">&#39;V = c&#39;</span><span class="p">,</span> 
                                            <span class="s">&#39;U = U + d &#39;</span><span class="p">,</span>
                                            <span class="n">al</span><span class="o">.</span><span class="n">OutputEvent</span><span class="p">(</span><span class="s">&#39;spikeoutput&#39;</span><span class="p">)]</span> <span class="p">)</span> <span class="p">]</span>
                <span class="p">)</span>
                 
<span class="c"># Create the ComponentClass, including the dynamics.</span>
<span class="n">iz</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span> 
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;IzikevichNeuron&quot;</span><span class="p">,</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">],</span>
        <span class="n">analog_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">AnalogPort</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;recv&#39;</span><span class="p">),</span>
                         <span class="n">al</span><span class="o">.</span><span class="n">AnalogPort</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="p">],</span>
        <span class="n">event_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">EventPort</span><span class="p">(</span><span class="s">&#39;spikeoutput&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="p">],</span>
        
        <span class="n">dynamics</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">(</span> <span class="n">regimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">regime</span><span class="p">],</span> 
                                <span class="n">state_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="s">&#39;U&#39;</span><span class="p">])</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-regimes-transitions">
<h2>Multiple Regimes &amp; Transitions<a class="headerlink" href="#multiple-regimes-transitions" title="Permalink to this headline">¶</a></h2>
<p>We have only discussed the case of a single regime.  A leaky integrate-and-fire
model with refractory period has two dynamical regimes - the sub-threshold
regime and the refractory regime. Just for fun, we&#8217;ll define the component in a
single step:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nineml.abstraction_layer</span> <span class="kn">as</span> <span class="nn">al</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span>
     <span class="n">name</span><span class="o">=</span><span class="s">&quot;sub-threshold-regime&quot;</span><span class="p">,</span>
     <span class="n">time_derivatives</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;dV/dt = (-gL*(V-vL) + I)/C&quot;</span><span class="p">,],</span>
     <span class="n">transitions</span><span class="o">=</span><span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">On</span><span class="p">(</span><span class="s">&quot;V&gt;Vth&quot;</span><span class="p">,</span>
                      <span class="n">do</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;tspike = t&quot;</span><span class="p">,</span>
                          <span class="s">&quot;V = V_reset&quot;</span><span class="p">,</span>
                          <span class="n">al</span><span class="o">.</span><span class="n">OutputEvent</span><span class="p">(</span><span class="s">&#39;spike&#39;</span><span class="p">)</span> <span class="p">],</span>
                      <span class="n">to</span><span class="o">=</span><span class="s">&quot;refractory-regime&quot;</span><span class="p">),</span> <span class="p">],</span>
     <span class="p">)</span>

<span class="n">r2</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;refractory-regime&quot;</span><span class="p">,</span>
        <span class="n">transitions</span><span class="o">=</span><span class="p">[</span><span class="n">al</span><span class="o">.</span><span class="n">On</span><span class="p">(</span><span class="s">&quot;t &gt;= tspike + trefractory&quot;</span><span class="p">,</span>
                        <span class="n">to</span><span class="o">=</span><span class="s">&quot;sub-threshold-regime&quot;</span><span class="p">),</span> <span class="p">],</span>
     <span class="p">)</span>

<span class="n">leaky_iaf</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span><span class="s">&quot;LeakyIAF&quot;</span><span class="p">,</span>
                <span class="n">dynamics</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">(</span> 
                                <span class="n">regimes</span><span class="o">=</span><span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">],</span> 
                                <span class="n">state_variables</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="s">&#39;tspike&#39;</span><span class="p">],</span>

                                <span class="p">),</span>
                <span class="n">analog_ports</span><span class="o">=</span><span class="p">[</span><span class="n">al</span><span class="o">.</span><span class="n">AnalogPort</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;recv&#39;</span><span class="p">)],</span>
                <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;V_reset&#39;</span><span class="p">,</span> <span class="s">&#39;Vth&#39;</span><span class="p">,</span> <span class="s">&#39;gL&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;trefractory&#39;</span><span class="p">,</span> <span class="s">&#39;vL&#39;</span><span class="p">],</span>
                <span class="p">)</span>


<span class="n">leaky_iaf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;leaky_iaf.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that here we used the <em>name</em> of the regime in the <tt class="docutils literal"><span class="pre">to</span></tt> argument to the
<tt class="docutils literal"><span class="pre">On</span></tt> transition constructor, rather than a <tt class="docutils literal"><span class="pre">Regime</span></tt> object. These references
are resolved automatically when the component is built.</p>
<p>If the differential equations for a <tt class="docutils literal"><span class="pre">StateVariable</span></tt> are not defined within a
regime, then it is assumed that the state-variable does not change in that
Regime, i.e. d/dt = 0.</p>
</div>
</div>
<div class="section" id="further-classes">
<h1>Further Classes<a class="headerlink" href="#further-classes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="aliases">
<h2>Aliases<a class="headerlink" href="#aliases" title="Permalink to this headline">¶</a></h2>
<p>Aliases are motivated by 2 cases; firstly that we would like to be able to
<tt class="docutils literal"><span class="pre">send</span></tt> something other than pure <tt class="docutils literal"><span class="pre">StateVariables</span></tt>,  and that often we end
up re-using calculations. For example, if we want to define a conductance-based
synapse in NineML, then we would like to specify the current in the
post-synaptic neuron.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nineml.abstraction_layer</span> <span class="kn">as</span> <span class="nn">al</span>

<span class="n">cond_decay</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;default&#39;</span><span class="p">,</span>
                    <span class="n">time_derivatives</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;dg/dt = -g/tau&quot;</span><span class="p">],</span>
                    <span class="n">transitions</span><span class="o">=</span><span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">On</span><span class="p">(</span> <span class="n">al</span><span class="o">.</span><span class="n">InputEvent</span><span class="p">(</span><span class="s">&#39;spikeinput&#39;</span><span class="p">),</span> <span class="n">do</span><span class="o">=</span><span class="s">&quot;g = g + q&quot;</span><span class="p">)]</span>
                    <span class="p">)</span>


<span class="n">coba_syn</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span>
                     <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CoBaSynapse&quot;</span><span class="p">,</span> 
                     <span class="n">dynamics</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">(</span>
                         <span class="n">regimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">cond_decay</span><span class="p">],</span> 
                         <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;I := g*(E-V)&quot;</span><span class="p">],</span>
                         <span class="p">),</span>
                     <span class="n">analog_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">RecvPort</span><span class="p">(</span><span class="s">&quot;V&quot;</span><span class="p">),</span> <span class="n">al</span><span class="o">.</span><span class="n">SendPort</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">)</span> <span class="p">]</span>
                     <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When specifying Aliases, we use the syntax <tt class="docutils literal"><span class="pre">:=</span></tt> instead of <tt class="docutils literal"><span class="pre">=</span></tt></p>
</div>
<p>In this case, we define an <tt class="docutils literal"><span class="pre">Alias</span></tt>, <em>I</em>, which can used in a <tt class="docutils literal"><span class="pre">send</span></tt> port.
Aliases can also be used on the right-hand-side of other aliases, <tt class="docutils literal"><span class="pre">Condition</span></tt>
s, <tt class="docutils literal"><span class="pre">StateAssignment</span></tt> s and <tt class="docutils literal"><span class="pre">TimeDerivative</span></tt> s.</p>
</div>
<div class="section" id="reduce-ports">
<h2>Reduce Ports<a class="headerlink" href="#reduce-ports" title="Permalink to this headline">¶</a></h2>
<p>We have discussed <tt class="docutils literal"><span class="pre">send</span></tt> and <tt class="docutils literal"><span class="pre">recv</span></tt> ports, but there is another
<em>port-mode</em>, which is <tt class="docutils literal"><span class="pre">reduce</span></tt>. A <tt class="docutils literal"><span class="pre">reduce</span></tt> port is also a port that takes
in data; but it can take information from multiple <tt class="docutils literal"><span class="pre">send</span></tt> ports. A typical
example might be the injected current into a neuron. Current can come into a
neuron from current injection, synapses or membrane channels. A <tt class="docutils literal"><span class="pre">recv</span></tt> port
is not sufficient in this case, because a <tt class="docutils literal"><span class="pre">recv</span></tt> port can only take
information from one other <tt class="docutils literal"><span class="pre">send</span></tt> port. Instead, we use a <tt class="docutils literal"><span class="pre">reduce</span></tt> port,
which takes an additional parameter <tt class="docutils literal"><span class="pre">reduce_op</span></tt>. This specifies how the
incoming data should be defined. For example, to calculate the total current
flowing into a cell, we would <tt class="docutils literal"><span class="pre">add</span></tt> all the current sources together, so we
would create the port as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span> <span class="o">=</span> <span class="n">AnalogPort</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;reduce&#39;</span><span class="p">,</span> <span class="n">reduce_op</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See the docs for <cite>AnalogPort</cite> for more information.</p>
<p>See XX [HH example] for examples of Reduce-Ports in action.</p>
</div>
<div class="section" id="specifying-mathematical-strings">
<h2>Specifying Mathematical Strings<a class="headerlink" href="#specifying-mathematical-strings" title="Permalink to this headline">¶</a></h2>
<p>When specifying mathematics, we use a notation similar to C/C++. That is:</p>
<div class="highlight-python"><pre>(3B + 1)V^2</pre>
</div>
<p>is not valid, it should be written as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">V</span> <span class="o">*</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Depending on what is being specified, we specify the mathematics slightly differently:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>Aliases</strong> should be of the form:</p>
<div class="highlight-python"><pre>alias := some * equation</pre>
</div>
</li>
<li><p class="first"><strong>TimeDerivatives</strong> for a state-variable, <em>S</em>, should be of the form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dS</span><span class="o">/</span><span class="n">dt</span> <span class="o">=</span> <span class="n">some</span> <span class="o">*</span> <span class="n">equation</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>StateAssignments</strong> must be written out in full; there is no in-place operators:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">g</span> <span class="o">+=</span> <span class="n">q</span>     <span class="c"># Invalid</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">+</span> <span class="n">q</span>  <span class="c"># Valid</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="shorthands-for-construction">
<h2>Shorthands for Construction<a class="headerlink" href="#shorthands-for-construction" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition " id="index-0">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Port mode -&gt; aliases curry classes</li>
<li>Inference of parameters</li>
</ul>
</div>
</div>
<div class="section" id="pseudo-code-for-simulation">
<h2>Pseudo Code for Simulation:<a class="headerlink" href="#pseudo-code-for-simulation" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basic Structure of NineML Abstraction Layer</a><ul>
<li><a class="reference internal" href="#interfaces-parameters-and-ports">Interfaces: Parameters and Ports</a></li>
<li><a class="reference internal" href="#dynamics-regimes-statevariables">Dynamics: Regimes &amp; StateVariables</a></li>
<li><a class="reference internal" href="#transitions-events-conditions-assignments">Transitions: Events, Conditions &amp; Assignments</a></li>
<li><a class="reference internal" href="#multiple-regimes-transitions">Multiple Regimes &amp; Transitions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-classes">Further Classes</a><ul>
<li><a class="reference internal" href="#aliases">Aliases</a></li>
<li><a class="reference internal" href="#reduce-ports">Reduce Ports</a></li>
<li><a class="reference internal" href="#specifying-mathematical-strings">Specifying Mathematical Strings</a></li>
<li><a class="reference internal" href="#shorthands-for-construction">Shorthands for Construction</a></li>
<li><a class="reference internal" href="#pseudo-code-for-simulation">Pseudo Code for Simulation:</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="al.html"
                        title="previous chapter">&lt;no title&gt;</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="importing_exporting.html"
                        title="next chapter">Importing and Exporting</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="importing_exporting.html" title="Importing and Exporting"
             >next</a> |</li>
        <li class="right" >
          <a href="al.html" title="&lt;no title&gt;"
             >previous</a> |</li>
        <li><a href="../../../index.html">NineML Python API Alpha documentation</a> &raquo;</li>
          <li><a href="../../../python_nineml.html" >Python NineML User Documentation</a> &raquo;</li>
          <li><a href="al.html" >&lt;no title&gt;</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Mike Hull, Eilif Muller, Andrew Davison.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
  </body>
</html>