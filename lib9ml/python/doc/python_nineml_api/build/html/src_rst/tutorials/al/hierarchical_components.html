

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Hierchical Components &mdash; NineML Python API Alpha documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'Alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="NineML Python API Alpha documentation" href="../../../index.html" />
    <link rel="up" title="&lt;no title&gt;" href="al.html" />
    <link rel="next" title="Simulating" href="interfacing_pynn.html" />
    <link rel="prev" title="Importing and Exporting" href="importing_exporting.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="interfacing_pynn.html" title="Simulating"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="importing_exporting.html" title="Importing and Exporting"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">NineML Python API Alpha documentation</a> &raquo;</li>
          <li><a href="../../../python_nineml.html" >Python NineML User Documentation</a> &raquo;</li>
          <li><a href="al.html" accesskey="U">&lt;no title&gt;</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="hierchical-components">
<h1>Hierchical Components<a class="headerlink" href="#hierchical-components" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subcomponents">
<h2>Subcomponents<a class="headerlink" href="#subcomponents" title="Permalink to this headline">¶</a></h2>
<p>Hierarchical components allow us to build a single component, out of several
smaller components. For example, imagine we could build a component that
represented an integrate-and-fire neuron (iaf) with 2 input synapses. We could
do this by either by creating a single component, as we have been doing
previously, or by creating 3 components; the iaf component and 2 synapses, and
then creating a larger component out of them by specifying internal
connectivity.</p>
<div class="admonition-todo admonition " id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">What would the combined code look like, example of why separating can be
good.</p>
</div>
<p>Building larger components out of smaller components has several advantages:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>We can define components in a reusable way. I.e., we can write the iaf</dt>
<dd><p class="first last">subcomponent once, then reuse it across multiple components.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>We can isolated unrelated variables; reducing the chance of a typo</dt>
<dd><p class="first last">producing a bug or variable collisions.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>We look at the IAF with 2 synapse example in more detail. Figure XX shows a
cartoon of an iaf neuron with a refractory period. Orange boxes denote regimes,
yellow ovals denote transitions and the ports are shown on the right-hand-side.
Parameters have been omitted.</p>
<img alt="../../../_images/iaf_component_im16.png" src="../../../_images/iaf_component_im16.png" />
<p>The corresponding code to generate this component is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r1</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;subthresholdregime&quot;</span><span class="p">,</span>
            <span class="n">time_derivatives</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;dV/dt = ( gl*( vrest - V ) + ISyn)/(cm)&quot;</span><span class="p">],</span>
            <span class="n">transitions</span> <span class="o">=</span> <span class="p">[</span><span class="n">al</span><span class="o">.</span><span class="n">On</span><span class="p">(</span><span class="s">&quot;V &gt; vthresh&quot;</span><span class="p">,</span>
                                   <span class="n">do</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;tspike = t&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;V = vreset&quot;</span><span class="p">,</span>
                                       <span class="n">al</span><span class="o">.</span><span class="n">OutputEvent</span><span class="p">(</span><span class="s">&#39;spikeoutput&#39;</span><span class="p">)],</span>
                                   <span class="n">to</span><span class="o">=</span><span class="s">&quot;refractoryregime&quot;</span><span class="p">),],</span>
          <span class="p">),</span>

<span class="n">r2</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;refractoryregime&quot;</span><span class="p">,</span>
                <span class="n">time_derivatives</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;dV/dt = 0&quot;</span><span class="p">],</span>
                                    <span class="n">transitions</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">On</span><span class="p">(</span><span class="s">&quot;t &gt;= tspike + taurefrac&quot;</span><span class="p">,</span>
                                                            <span class="n">to</span><span class="o">=</span><span class="s">&quot;subthresholdregime&quot;</span><span class="p">)</span> <span class="p">],</span>
                                    <span class="p">)</span>

<span class="n">iaf</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;iaf&quot;</span><span class="p">,</span>
                        <span class="n">dynamics</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">(</span> <span class="n">regimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">]</span> <span class="p">),</span>
                        <span class="n">analog_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">SendPort</span><span class="p">(</span><span class="s">&quot;V&quot;</span><span class="p">),</span> <span class="n">al</span><span class="o">.</span><span class="n">ReducePort</span><span class="p">(</span><span class="s">&quot;ISyn&quot;</span><span class="p">,</span> <span class="n">reduce_op</span><span class="o">=</span><span class="s">&quot;+&quot;</span><span class="p">)</span> <span class="p">],</span>
                         <span class="n">event_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">SendEventPort</span><span class="p">(</span><span class="s">&#39;spikeoutput&#39;</span><span class="p">)</span> <span class="p">],</span>
                        <span class="p">)</span>
</pre></div>
</div>
<p>Similarly, we can define a synapse component:</p>
<img alt="../../../_images/coba_component_im16.png" src="../../../_images/coba_component_im16.png" />
<p>with corresponding code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">coba</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span>
                         <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CobaSyn&quot;</span><span class="p">,</span>
                         <span class="n">dynamics</span> <span class="o">=</span>
                            <span class="n">al</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">(</span>
                                <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;I:=g*(vrev-V)&quot;</span><span class="p">,</span> <span class="p">],</span>
                                <span class="n">regimes</span> <span class="o">=</span> <span class="p">[</span>
                                  <span class="n">al</span><span class="o">.</span><span class="n">Regime</span><span class="p">(</span>
                                     <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;cobadefaultregime&quot;</span><span class="p">,</span>
                                     <span class="n">time_derivatives</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;dg/dt = -g/tau&quot;</span><span class="p">,],</span>
                                     <span class="n">transitions</span> <span class="o">=</span> <span class="p">[</span>
                                         <span class="n">al</span><span class="o">.</span><span class="n">On</span><span class="p">(</span><span class="n">al</span><span class="o">.</span><span class="n">InputEvent</span><span class="p">(</span><span class="s">&#39;spikeinput&#39;</span><span class="p">),</span> <span class="n">do</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;g=g+q&quot;</span><span class="p">]),</span>
                                         <span class="p">],</span>
                                     <span class="p">)</span>
                                    <span class="p">],</span>
                                <span class="n">state_variables</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">StateVariable</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">)</span> <span class="p">]</span>
                                <span class="p">),</span>

                         <span class="n">analog_ports</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">RecvPort</span><span class="p">(</span><span class="s">&quot;V&quot;</span><span class="p">),</span> <span class="n">al</span><span class="o">.</span><span class="n">SendPort</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">),</span> <span class="p">],</span>
                         <span class="n">event_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">al</span><span class="o">.</span><span class="n">RecvEventPort</span><span class="p">(</span><span class="s">&#39;spikeinput&#39;</span><span class="p">)</span> <span class="p">],</span>
                         <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span> <span class="n">al</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;tau&#39;</span><span class="p">,</span><span class="s">&#39;q&#39;</span><span class="p">,</span><span class="s">&#39;vrev&#39;</span><span class="p">]</span>  <span class="p">]</span>
                         <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="namespaces-port-connections">
<h2>Namespaces &amp; Port Connections:<a class="headerlink" href="#namespaces-port-connections" title="Permalink to this headline">¶</a></h2>
<p>We now define a larger component, which will contain these subcomponents. When
we create the component, we specify the <em>namespace</em> of each subcomponent, which
allows us to reference them in the future.</p>
<p>We also need to specify that the voltage send port from the iaf needs to be
connected to the voltage receive ports of the synapse. Similarly we need to
connect the current port from the synapses into the current reduce port on the
iaf neuron. These connections are shown in red on the diagram, and correspond to
the <tt class="docutils literal"><span class="pre">connect_port</span></tt> method calls in the code.</p>
<p>In a diagram:</p>
<img alt="../../../_images/iaf_coba2_component_im16.png" src="../../../_images/iaf_coba2_component_im16.png" />
<p>In code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create a model, composed of an iaf neuron, and</span>
<span class="n">iaf_2coba_comp</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="n">ComponentClass</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;iaf_2coba&quot;</span><span class="p">,</span>
                                    <span class="n">subnodes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;iaf&quot;</span> <span class="p">:</span> <span class="n">get_iaf</span><span class="p">(),</span>
                                                <span class="s">&quot;coba_excit&quot;</span> <span class="p">:</span> <span class="n">get_coba</span><span class="p">(),</span>
                                                <span class="s">&quot;coba_inhib&quot;</span> <span class="p">:</span> <span class="n">get_coba</span><span class="p">()}</span>
                                  <span class="p">)</span>

<span class="n">iaf_2coba_comp</span><span class="o">.</span><span class="n">connect_ports</span><span class="p">(</span> <span class="s">&quot;iaf.V&quot;</span><span class="p">,</span> <span class="s">&quot;coba_excit.V&quot;</span> <span class="p">)</span>
<span class="n">iaf_2coba_comp</span><span class="o">.</span><span class="n">connect_ports</span><span class="p">(</span> <span class="s">&quot;iaf.V&quot;</span><span class="p">,</span> <span class="s">&quot;coba_inhib.V&quot;</span> <span class="p">)</span>
<span class="n">iaf_2coba_comp</span><span class="o">.</span><span class="n">connect_ports</span><span class="p">(</span> <span class="s">&quot;coba_excit.I&quot;</span><span class="p">,</span> <span class="s">&quot;iaf.ISyn&quot;</span> <span class="p">)</span>
<span class="n">iaf_2coba_comp</span><span class="o">.</span><span class="n">connect_ports</span><span class="p">(</span> <span class="s">&quot;coba_inhib.I&quot;</span><span class="p">,</span> <span class="s">&quot;iaf.ISyn&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="flattening-components">
<h2>Flattening Components<a class="headerlink" href="#flattening-components" title="Permalink to this headline">¶</a></h2>
<p>Provided the number of regimes and subcomponents is relatively low; it is
possible to take a hierarchical component, and flatten it into a single component
with no subcomponents. This can be done using the methods in the  <tt class="docutils literal"><span class="pre">ComponentFlattener</span></tt> class,
or the wrapper function <tt class="docutils literal"><span class="pre">flatten</span></tt>. This flattening takes the cross product of
all the regimes in all the subcomponents, then works out the relevant
transitions and flattens the namespaces.</p>
<p>We can test components to see if they are flat using the <tt class="docutils literal"><span class="pre">is_flat</span></tt> method.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Hierchical Components</a><ul>
<li><a class="reference internal" href="#subcomponents">Subcomponents</a></li>
<li><a class="reference internal" href="#namespaces-port-connections">Namespaces &amp; Port Connections:</a></li>
<li><a class="reference internal" href="#flattening-components">Flattening Components</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="importing_exporting.html"
                        title="previous chapter">Importing and Exporting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="interfacing_pynn.html"
                        title="next chapter">Simulating</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="interfacing_pynn.html" title="Simulating"
             >next</a> |</li>
        <li class="right" >
          <a href="importing_exporting.html" title="Importing and Exporting"
             >previous</a> |</li>
        <li><a href="../../../index.html">NineML Python API Alpha documentation</a> &raquo;</li>
          <li><a href="../../../python_nineml.html" >Python NineML User Documentation</a> &raquo;</li>
          <li><a href="al.html" >&lt;no title&gt;</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Mike Hull, Eilif Muller, Andrew Davison.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
  </body>
</html>